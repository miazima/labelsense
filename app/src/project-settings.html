<link rel="import" href="../bower_components/paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="../bower_components/paper-checkbox/paper-checkbox.html">
<link rel="import" href="../bower_components/paper-listbox/paper-listbox.html">
<link rel="import" href="../bower_components/paper-input/paper-textarea.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/paper-input/paper-input.html">
<link rel="import" href="../bower_components/paper-card/paper-card.html">
<link rel="import" href="../bower_components/paper-item/paper-item.html">
<link rel="import" href="../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../bower_components/iron-a11y-keys/iron-a11y-keys.html">
<link rel="import" href="../bower_components/neon-animation/neon-shared-element-animatable-behavior.html">
<link rel="import" href="../bower_components/neon-animation/neon-animation-runner-behavior.html">
<link rel="import" href="../bower_components/neon-animation/neon-animations.html">
<link rel="import" href="theme/shared-styles.html">

<dom-module id="project-settings">
	<template>
		<style include="shared-styles">
			:host {
				display: block;
			}
			.paper-font-title {
				padding: 20px;
				border-bottom: 1px solid var(--paper-amber-a700);
				width: 40%;
			}
			.paper-font-title:not(:first-child) {
				margin-top: 35px;
			}
			div.settings {
				padding: 20px;
			}
			paper-textarea.textarea {
				max-width: 800px;
			}
			paper-item {
				cursor: pointer;
				--paper-item-focused: { color: var(--paper-amber-700); };
			}
			paper-item:hover { background: var(--paper-grey-100); }
			paper-button.save { background: var(--paper-amber-a700); }
			paper-listbox { min-width: 200px; }
			paper-button.accent-btn {
				padding: 0.5em 1em;
			}
			iron-icon.delete {
				width: 20px;
				padding-left: 10px;
				opacity: 0.5;
				transition: opacity 0.3s;
			}
			iron-icon.delete:hover {
				opacity: 1;
			}
			.fixed {
        position: fixed;
        top: 0px;
        left: 0;
        height: 100vh;
        width: 100vw;
        background: var(--paper-grey-200);
    		opacity: 0.5;
      }
      .card {
      	background: white;
      	position: relative;
        margin: 0px 50px 0;
      }
      .content-wrapper { padding: 15px; }
		</style>
		<div id="fixed" class="fixed" on-tap="closeSettings"></div>
		<paper-card id="card" class="card main-content-wrapper layout vertical">
			
			<div class="settings layout horizontal justified">
				<div class="paper-font-display1">[[project]]</div>
				<paper-dropdown-menu label="Switch Project">
				  <paper-listbox class="dropdown-content" selected="1">
				    <template is="dom-repeat" items={{projectList}}>
				    	<paper-item>[[item.prj]]</paper-item>
				    </template>
				  </paper-listbox>
				</paper-dropdown-menu>
			</div>
			
			<div class="paper-font-title">Page Display</div>
			<div class="settings layout horizontal wrap">
				<paper-dropdown-menu label="Number of sentences per page:">
				  <paper-listbox class="dropdown-content" selected="{{settings.display}}" attr-for-selected="name">
				    <paper-item name="5">5 sentences</paper-item>
				    <paper-item name="10">10 sentences</paper-item>
				    <paper-item name="15">15 sentences</paper-item>
				    <paper-item name="20">20 sentences</paper-item>
				  </paper-listbox>
				</paper-dropdown-menu>
			</div>

			<div class="paper-font-title">User Instructions</div>
			<div class="settings">
				<paper-textarea class="textarea" label="Instructions for your users" value="{{settings.instructions}}"></paper-textarea>
			</div>

			<div class="paper-font-title">Labels</div>
			<div class="settings layout vertical">
				<div class="content-wrapper">
					<paper-checkbox checked="{{settings.multiLabel}}">Enable multiple labels for each token</paper-checkbox>
				</div>
				<div class="content-wrapper layout horizontal">
					<paper-input-container id="txt-add" class="ta-default-textfield" no-label-float placeholder="Add new label">
	          <iron-a11y-keys id="a11y" target="[[targetStopwordInput]]" keys="enter" on-keys-pressed="addLabel"></iron-a11y-keys>
	          <iron-icon icon="add" prefix></iron-icon>
	          <input id="stopwordAddTextBox" is="iron-input" bind-value="{{inputLabel}}">
	        </paper-input-container>
				</div>
				<div id="labels" class="content-wrapper layout horizontal wrap">
					<template is="dom-repeat" items=[[labels]]>
						<paper-button class="accent-btn" raised>
							<span>[[item]]</span>
							<iron-icon icon="clear" class="delete" on-tap="removeLabel"></iron-icon>
						</paper-button>
					</template>
				</div>
			</div>

			<div>
				<paper-button class="save accent-btn" on-tap="saveSettings" raised>save changes</paper-button>
			</div>
			
		</paper-card>
		
	</template>
	<script>
		Polymer({
			is: 'project-settings',

			behaviors: [
				Polymer.NeonSharedElementAnimatableBehavior,
		    Polymer.NeonAnimationRunnerBehavior
		  ],

			properties: {
				projectList: Array,
				project: String,
				inputLabel: String,
				deletedLabel: String,
				settings: {
					type: Object,
					observer: '_getSettings'
				},
				labels: Array,
				sharedElements: {
	        type: Object,
	        value: function() {
	          return {
	            'hero': this.$.card,
	            'ripple': this.$.fixed
	          }
	        }
	      },
				animationConfig: {
					value: function() {
						return {
							'exitLabel': {
								name: 'fade-out-animation'
							},
							'slideLabels': {
								name: 'cascaded-animation',
								animation: 'slide-from-right-animation',
								timing: {duration: 800}
							},
							'entryLabel': {
								name: 'fade-in-animation',
							},
							'entry': [{
	              name: 'ripple-animation',
	              id: 'ripple',
	              toPage: this,
	            }, {
	              name: 'hero-animation',
	              id: 'hero',
	              toPage: this,
	              timing: {
	                delay: 150
	              }
	            }],
	            'exit': [{
	              name: 'fade-out-animation',
	              node: this.$.fixed
	            }, {
	              name: 'transform-animation',
	              transformFrom: 'none',
	              transformTo: 'translate(0px,-200vh) scale(0.9,1)',
	              node: this.$.card
	            }]
						}
					}
				}
			},

			listeners: {
		    'neon-animation-finish': '_onNeonAnimationFinish'
		  },

		  _getSettings: function(sets) {
		  	if (!sets) this.settings = {};
		  },

			addLabel: function() {
				if (!this.inputLabel) return;
				this.push('labels', this.inputLabel.trim());
				this.inputLabel = '';

				this.async(function() {
					var labels = this.$.labels.querySelectorAll('paper-button');
					var added = labels[labels.length - 1];
					this.animationConfig.entryLabel.node = added;
	        this.playAnimation('entryLabel');
				});
			},

			removeLabel: function(e) {
				this.deletedLabel = e.model.item;
				this.animationConfig.exitLabel.node = e.target.parentElement;
				
        this.playAnimation('exitLabel', 'removeLabel');
			},

			_onNeonAnimationFinish: function(e, animation) {
				switch(animation) {
			    case 'removeLabel':
			      var index = this.labels.indexOf(this.deletedLabel);
		        this.splice('labels', index, 1);

		        this.async(function() {
		        	var labels = this.$.labels.querySelectorAll('paper-button');
							var slide = [];
							for (var i = index; i < labels.length; i++) {
								slide.push(labels[i]);
							}
			        this.animationConfig.slideLabels.nodes = slide;
			        this.playAnimation('slideLabels');
		        });
			      break;
			  }
			},

			saveSettings: function() {
				this.fire('save-settings', {
					settings: this.settings,
					labels: this.labels
				});
			},

			closeSettings: function() {
				this.fire('close-settings');
			}

		});
	</script>
</dom-module>