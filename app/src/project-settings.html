<link rel="import" href="../bower_components/paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="../bower_components/paper-listbox/paper-listbox.html">
<link rel="import" href="../bower_components/paper-input/paper-textarea.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/paper-input/paper-input.html">
<link rel="import" href="../bower_components/paper-item/paper-item.html">
<link rel="import" href="../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../bower_components/iron-a11y-keys/iron-a11y-keys.html">
<link rel="import" href="../bower_components/neon-animation/neon-animation-runner-behavior.html">
<link rel="import" href="../bower_components/neon-animation/animations/fade-out-animation.html">
<link rel="import" href="../bower_components/neon-animation/animations/fade-in-animation.html">
<link rel="import" href="theme/shared-styles.html">
<link rel="import" href="api/api-settings.html">

<dom-module id="project-settings">
	<template>
		<style include="shared-styles">
			:host {
				display: block;
			}
			.paper-font-title {
				padding: 20px;
				border-bottom: 1px solid var(--paper-teal-a700);
				width: 40%;
			}
			.paper-font-title:not(:first-child) {
				margin-top: 35px;
			}
			div.settings {
				padding: 20px;
			}
			paper-textarea.textarea {
				width: 40%;
			}
			paper-item {
				cursor: pointer;
				--paper-item-focused: { color: var(--paper-teal-500); };
			}
			paper-button.save { background: var(--paper-teal-a700); }
			paper-item:hover { background: var(--paper-grey-200); }
			paper-listbox { min-width: 200px; }
			paper-button.accent-btn {
				padding: 0.5em 1em;
			}
			iron-icon.delete {
				width: 20px;
				padding-left: 10px;
				opacity: 0.5;
				transition: opacity 0.3s;
			}
			iron-icon.delete:hover {
				opacity: 1;
			}
		</style>

		<api-settings project-name="[[projectName]]" settings="{{settings}}"></api-settings>

		<div class="main-content-wrapper layout vertical wrap">
			
			<div class="layout horizontal justified">
				<div class="paper-font-display1">ProjectName</div>
				<paper-dropdown-menu label="Switch Project">
					  <paper-listbox class="dropdown-content" selected="1">
					    <template is="dom-repeat" items={{projectList}}>
					    	<paper-item>[[item.prj]]</paper-item>
					    </template>
					  </paper-listbox>
					</paper-dropdown-menu>
			</div>
			<div>
				<paper-button class="save accent-btn" on-tap="saveSettings" raised>save</paper-button>
			</div>
			
			<div class="paper-font-title">Page Display</div>
			<div class="settings layout horizontal wrap">
				<paper-dropdown-menu label="Number of sentences per page:">
				  <paper-listbox class="dropdown-content" selected="{{settings.display}}">
				    <paper-item>5 sentences</paper-item>
				    <paper-item>10 sentences</paper-item>
				    <paper-item>15 sentences</paper-item>
				    <paper-item>20 sentences</paper-item>
				  </paper-listbox>
				</paper-dropdown-menu>
			</div>

			<div class="paper-font-title">User Instructions</div>
			<div class="settings">
				<paper-textarea class="textarea" label="Instructions for your users" value="{{settings.instructions}}"></paper-textarea>
			</div>

			<div class="paper-font-title">Labels</div>
			<div class="settings layout vertical">
				<div class="content-wrapper layout horizontal">
					<paper-input-container id="txt-add" class="ta-default-textfield" no-label-float placeholder="Add new label">
	          <iron-a11y-keys id="a11y" target="[[targetStopwordInput]]" keys="enter" on-keys-pressed="addLabel"></iron-a11y-keys>
	          <iron-icon icon="add" prefix></iron-icon>
	          <input id="stopwordAddTextBox" is="iron-input" bind-value="{{inputLabel}}">
	        </paper-input-container>
				</div>
				<div id="labels" class="content-wrapper layout horizontal wrap">
					<template is="dom-repeat" items={{labels}}>
						<paper-button class="accent-btn" raised>
							<span>[[item]]</span>
							<iron-icon icon="clear" class="delete" on-tap="removeLabel"></iron-icon>
						</paper-button>
					</template>
				</div>
			</div>
			
		</div>
		
	</template>
	<script>
		Polymer({
			is: 'project-settings',

			behaviors: [
		    Polymer.NeonAnimationRunnerBehavior
		  ],

			properties: {
				projectList: Array,
				project: String,
				inputLabel: String,
				deletedLabel: String,
				settings: {
					type: Object,
					value: function() {
						return {};
					}
				},
				labels: {
					type: Array,
					value: function() {
						return [];
					}
				},
				animationConfig: {
					value: function() {
						return {
							'exitLabel': {
								name: 'fade-out-animation'
							},
							'entryLabels': {
								name: 'fade-in-animation',
								node: this.$.labels,
								timing: {
									duration: 5000
								}
							}
						}
					}
				}
			},

			listeners: {
		    'neon-animation-finish': '_onNeonAnimationFinish'
		  },

			addLabel: function() {
				if (!this.inputLabel) return;
				this.push('labels', this.inputLabel.trim());
				this.inputLabel = '';
			},

			removeLabel: function(e) {
				this.deletedLabel = e.model.item;
				this.animationConfig.exitLabel.node = e.target.parentElement;
        this.playAnimation('exitLabel', 'removeLabel');
			},

			_onNeonAnimationFinish: function(e, animation) {
				console.log(e, animation);
				switch(animation) {
			    case 'removeLabel':
		        // this.playAnimation('entryLabels');
			      var index = this.labels.indexOf(this.deletedLabel);
		        this.splice('labels', index, 1);
			      break;
			  }
			},

			saveSettings: function() {
				console.log(this.settings);
				console.log(this.labels);
			}

		});
	</script>
</dom-module>