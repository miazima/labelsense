<link rel="import" href="../bower_components/paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="../bower_components/paper-listbox/paper-listbox.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/paper-item/paper-item.html">
<link rel="import" href="../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../bower_components/hiveoss-common-libraries/moment.html">
<link rel="import" href="../bower_components/neon-animation/neon-shared-element-animatable-behavior.html">
<link rel="import" href="theme/shared-styles.html">

<dom-module id="project-list">
	<template>
		<style include="shared-styles">
			:host {
				display: block;
			}
			div.header {
				padding: 1em;
				background: var(--paper-teal-100);
			}
			div.row {
				background: var(--paper-grey-50);
				padding: 1em;
				cursor: pointer;
			}
			div.row:hover { background: var(--paper-grey-200); }
			div.settings { padding: 20px; }
			div.settings > * { padding-bottom: 20px; }
			paper-dropdown-menu {
				--paper-dropdown-menu: {
					/*font-size: 16px;*/
				};
				 --paper-input-container-label: {
            color: var(--paper-teal-500);
            font-size: 20px;
        };
			}
			paper-item {
				cursor: pointer;
				--paper-item-focused: { color: var(--paper-teal-500); };
			}
			paper-item:hover { background: var(--paper-grey-200); }
			iron-icon.info {
				--iron-icon-fill-color: var(--paper-indigo-500);
				padding-right: 10px;
			}
			div.preview { padding-left: 20px; }
		</style>

		<div class="settings">
			<div class="layout horizontal">
				<iron-icon class="info" icon="info"></iron-icon>
				<div hidden$="[[!_computeInfo(projectList)]]" class="paper-font-subhead">Choose a project for users to label</div>
				<div hidden$="[[_computeInfo(projectList)]]" class="paper-font-subhead">Create a project!</div>
			</div>
			<div class="layout horizontal">
				<paper-dropdown-menu label="Switch Current Project" disabled="[[!_computeInfo(projectList)]]">
				  <paper-listbox class="dropdown-content" selected="{{defaultProject}}" attr-for-selected="value"> 
				    <template is="dom-repeat" items={{projectList}}>
				    	<paper-item value="[[item.prj]]">[[item.prj]]</paper-item>
				    </template>
				  </paper-listbox>
				</paper-dropdown-menu>

				<div class="preview self-center">
					<paper-button class="teal-accent-btn" raised>View Preview</paper-button>
				</div>
			</div>
		</div>

		<div class="layout vertical" style$="opacity: [[_computeOpacity(projectList)]];">
			<div class="layout horizontal header">
				<div class="flex">Project Name</div>
				<div class="flex">Created</div>
				<div class="flex">Labels</div>
			</div>

			<template is="dom-repeat" items={{projectList}}>
				<div class="layout horizontal row" on-tap="openSettings">
					<div class="flex">[[item.prj]]</div>
					<div class="flex">{{parseDateTime(item.created)}}</div>
					<div class="flex">[[parseLabels(item.labels)]]</div>
					</div>
			</template>
		</div>
		
	</template>
	<script>
		Polymer({
			is: 'project-list',

			behaviors: [
	      Polymer.NeonSharedElementAnimatableBehavior
	    ],

			properties: {
				project: {
					type: String,
					notify: true
				},
				projectList: {
					type: Array
				},
				defaultProject: {
					type: String,
					observer: '_getDefaultProject'
				},
				uid: String,
				animationConfig: {
					type: Object,
					value: function() {
						return {
							'exit': [{
	              name: 'ripple-animation',
	              id: 'ripple',
	              fromPage: this
	            }, {
	              name: 'hero-animation',
	              id: 'hero',
	              fromPage: this
	            }]
						};
					}
				}
			},

			observer: [
				'init(defaultProject)'
			],

			init: function(list) {
				console.log(list);
			},

			_computeInfo: function(list) {
				if (!list || list.length === 0) return false;
				return true;
			},

			_computeOpacity: function(list) {
				if (!list || list.length === 0) return 0.4;
				return 1;
			},

			_getDefaultProject: function(prj) {
				if (this.projectList && this.projectList.length === 1) {
					this.fire('set-default-prj', this.projectList[0].prj);
					return;
				}
				this.fire('set-default-prj', prj);
			},

			parseLabels: function(labels) {
				return labels.join(', ');
			},

			parseDateTime: function(ts) {
				var two_weeks_ago = moment().subtract(7, 'days');
        if (moment(ts).isAfter(two_weeks_ago)) {
          return moment(ts).fromNow() + ' | ' + moment(ts).format('dddd h:mm A');
        }
        return moment(ts).format('ddd MMM Do YYYY h:mm A');
      },

			openSettings: function(event) {
				var target = event.target;
	      while (target !== this && !target._templateInstance) {
	        target = target.parentNode;
	      }

				// configure the page animation
	      this.sharedElements = {
	        'hero': target,
	        'ripple': target
	      };
	      this.animationConfig['exit'][0].gesture = {
	       	x: event.detail.x,
	        y: event.detail.y
	      };
	      this.project = event.model.item.prj;
	      this.fire('open-settings');
			}

		});
	</script>
</dom-module>