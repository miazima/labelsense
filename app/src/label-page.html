<link rel="import" href="../bower_components/neon-animation/neon-animation.html">
<link rel="import" href="../bower_components/paper-card/paper-card.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/paper-fab/paper-fab.html">
<link rel="import" href="../bower_components/iron-pages/iron-pages.html">
<link rel="import" href="theme/shared-styles.html">

<dom-module id="label-page">
	<template>
		<style include="shared-styles">
			:host {
				display: block;
			}
			paper-button[toggles][active] {
			  background: var(--paper-indigo-500);
			}
			.card-actions {
				padding: 10px 16px;
			}
			paper-fab { --paper-fab-background: var(--paper-teal-a700); }
			.teal-accent-btn { 
				padding-left: 30px; 
				padding-right: 30px; 
			}
			.main-wrapper { padding-bottom: 3em; }
			div.token {
				margin: 30px;
			}
		</style>

		<div class="main-wrapper layout vertical center">

			<div class="paper-font-title self-stretch">Project Name</div>

			<div>
				<iron-pages selected="{{selectedPage}}">
					<template id="firstRepeat" is="dom-repeat" items={{splitTokens}}>
						<div class$="content_[[index]]">
							<template class$="secondRepeat_[[index]]" is="dom-repeat" items={{item}}>
								<div class="token layout horizontal">
									<paper-card class="layout vertical">
									  <div class="card-content">[[item]]</div>
									</paper-card>
								 <div class="layout vertical">
								 	<template is="dom-repeat" items={{labels}}>
							    	<paper-button class="label-btn" on-tap="updateData" toggles>[[item]]</paper-button>
							    </template>
								 </div>
							</template>
							</div>
						</div>
					</template>
				</iron-pages>
			</div>

			<div class="layout horizontal justified self-stretch">
				<paper-fab icon="arrow-back" disabled="[[_disableNav(splitTokens,selectedPage,'prev')]]" on-tap="prevPage"></paper-fab>
				<paper-fab icon="arrow-forward" disabled="[[_disableNav(splitTokens,selectedPage,'next')]]" on-tap="nextPage"></paper-fab>
			</div>

			<div class="layout vertical" hidden$="[[_displaySave(splitTokens,selectedPage)]]">
				<div class="self-center"><paper-button class="teal-accent-btn" on-tap="_submitLabels" raised>submit</paper-button></div>
			</div>
		</div>

		
		
	</template>
	<script>
		Polymer({
			is: 'label-page',

			behaviors: [
				Polymer.NeonAnimationRunnerBehavior
			],

			properties: {
				tokens: Array,
				tokensPerPage: Number,
				labels: Array,
				selectedPage: {
					type: Number,
					value: 0
				},
				labelData: Array,
				splitTokens: Array,
				animationConfig: {
					type: Object,
					value: function() {
						return {
							next: [{
								name: 'slide-from-right-animation',
								timing: {delay: 200}
							}, {
								name: 'fade-out-animation',
								timing: {duration: 300}
							}],
							previous: [{
								name: 'slide-from-left-animation',
								timing: {delay: 200}
							}, {
								name: 'fade-out-animation',
								timing: {duration: 300}
							}]
						};
					}
				}
			},

			observers: [
				'computeSplitTokens(tokens,tokensPerPage)'
			],

			listeners: {
				'neon-animation-finish': '_onNeonAnimationFinish'
			},

			_onNeonAnimationFinish: function(e, animation) {
				// switch (animation) {
				// 	case 'next': 
				// 		break;
				// }
			},

			_displaySave: function(tokens, page) {
				if (page !== tokens.length - 1) return true;
				return false;
			},

			_submitLabels: function() {
				// this.fire('route-page', 'thankyou', {bubbles: true});
			},

			updateData: function(e) {
				var page = this.$.firstRepeat.modelForElement(e.target).index;
				var token = this.$$('.secondRepeat_' + page).modelForElement(e.target).index;
				tokenID = (this.tokensPerPage * page) + token;
				var label = e.model.item;
				// console.log(this.$.firstRepeat.modelForElement(e.target).index);
				// console.log(this.$$('.secondRepeat_' + this.$.firstRepeat.modelForElement(e.target).index).modelForElement(e.target).index);
				// console.log(e.model.index, e.model.item);
			},

			computeSplitTokens: function(tokens, chunk) {
				this.splitTokens = [];
				var temparray = [];

				for (var i = 0; i < tokens.length; i += chunk) {
				    temparray.push(tokens.slice(i, i + chunk));
				}
				this.splitTokens = temparray;
			},

			_computeTokens: function(tokens, page) {
				return tokens[page];
			},

			_disableNav: function(tokens, page, direction) {
				if (direction === 'next' && page === tokens.length - 1)
					return true;
				if (direction === 'prev' && page === 0)
					return true;
				return false;
			},

			prevPage: function() {
				this.animationConfig.previous[0].node = this.$$('.content_' + (this.selectedPage - 1));
				this.animationConfig.previous[1].node = this.$$('.content_' + this.selectedPage );
				this.playAnimation('previous');
				this.async(function() {
					this.selectedPage = this.selectedPage - 1;
				}, 300);
			},

			nextPage: function() {
				this.animationConfig.next[0].node = this.$$('.content_' + (this.selectedPage + 1));
				this.animationConfig.next[1].node = this.$$('.content_' + this.selectedPage );
				this.playAnimation('next');
				this.async(function() {
					this.selectedPage = this.selectedPage + 1;
				}, 300);

				var progress = this.selectedPage * 20;
				this.fire('progress-bar', progress, {bubbles: true});
			},

			attached: function () {
				this.tokens = [
        "Excited him now natural saw passage offices you minuter. At by asked being court hopes. Farther so friends am to detract. Forbade concern do private be. Offending residence but men engrossed shy. Pretend am earnest offered arrived company so on. Felicity informed yet had admitted strictly how you.",
        "But why smiling man her imagine married. Chiefly can man her out believe manners cottage colonel unknown. Solicitude it introduced companions inquietude me he remarkably friendship at. My almost or horses period. Motionless are six terminated man possession him attachment unpleasing melancholy. Sir smile arose one share. No abroad in easily relied an whence lovers temper by. Looked wisdom common he an be giving length mr.",
        "Same an quit most an. Admitting an mr disposing sportsmen. Tried on cause no spoil arise plate. Longer ladies valley get esteem use led six. Middletons resolution advantages expression themselves partiality so me at. West none hope if sing oh sent tell is.",
        "At distant inhabit amongst by. Appetite welcomed interest the goodness boy not. Estimable education for disposing pronounce her. John size good gay plan sent old roof own. Inquietude saw understood his friendship frequently yet. Nature his marked ham wished.",
        "Or neglected agreeable of discovery concluded oh it sportsman. Week to time in john. Son elegance use weddings separate. Ask too matter formed county wicket oppose talent. He immediate sometimes or to dependent in. Everything few frequently discretion surrounded did simplicity decisively. Less he year do with no sure loud.",
        "Whole wound wrote at whose to style in. Figure ye innate former do so we. Shutters but sir yourself provided you required his. So neither related he am do believe. Nothing but you hundred had use regular. Fat sportsmen arranging preferred can. Busy paid like is oh. Dinner our ask talent her age hardly. Neglected collected an attention listening do abilities.",
        "Boisterous he on understood attachment as entreaties ye devonshire. In mile an form snug were been sell. Hastened admitted joy nor absolute gay its. Extremely ham any his departure for contained curiosity defective. Way now instrument had eat diminution melancholy expression sentiments stimulated. One built fat you out manor books. Mrs interested now his affronting inquietude contrasted cultivated. Lasting showing expense greater on colonel no.",
        "Continual delighted as elsewhere am convinced unfeeling. Introduced stimulated attachment no by projection. To loud lady whom my mile sold four. Need miss all four case fine age tell. He families my pleasant speaking it bringing it thoughts. View busy dine oh in knew if even. Boy these along far own other equal old fanny charm. Difficulty invitation put introduced see middletons nor preference.",
        "Months on ye at by esteem desire warmth former. Sure that that way gave any fond now. His boy middleton sir nor engrossed affection excellent. Dissimilar compliment cultivated preference eat sufficient may. Well next door soon we mr he four. Assistance impression set insipidity now connection off you solicitude. Under as seems we me stuff those style at. Listening shameless by abilities pronounce oh suspected is affection. Next it draw in draw much bred.",
        "And produce say the ten moments parties. Simple innate summer fat appear basket his desire joy. Outward clothes promise at gravity do excited. Sufficient particular impossible by reasonable oh expression is. Yet preference connection unpleasant yet melancholy but end appearance. And excellence partiality estimating terminated day everything.",
        "To sure calm much most long me mean. Able rent long in do we. Uncommonly no it announcing melancholy an in. Mirth learn it he given. Secure shy favour length all twenty denote. He felicity no an at packages answered opinions juvenile.",
        "Examine she brother prudent add day ham. Far stairs now coming bed oppose hunted become his. You zealously departure had procuring suspicion. Books whose front would purse if be do decay. Quitting you way formerly disposed perceive ladyship are. Common turned boy direct and yet."
      ];
			}
		});
	</script>
</dom-module>