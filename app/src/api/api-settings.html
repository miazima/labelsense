<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="./api-behavior.html">

<dom-module id="api-settings">
  <template>
  
    <iron-ajax id="xhr"
      url="[[url]]"
      method="POST"
      handle-as="json"
      content-type="application/json"
      body="[[_body]]"
      loading="{{loading}}"
      last-error="{{_ajaxError}}"
      last-response="{{_results}}"></iron-ajax>

    <iron-ajax id="xhr2"
        url="[[url]]"
        method="GET"
        handle-as="json"
        content-type="application/json"
        params="[[_params]]"
        loading="{{loading}}"
        last-error="{{_ajaxError}}"
        last-response="{{_results2}}"></iron-ajax>

  </template>

  <script>
    (function() {
      'use strict';

      Polymer({
        is: 'api-settings',
        behaviors: [
          HiveOSS.ApiBehavior
        ],
        properties: {
          uid: String,
          /*
           * Project name for the file.
           */
          project: String,
          _results2: Object,
          url: {
            type: String,
            value: 'api/settings'
          },
          valid: {
            type: Boolean,
            notify: true,
            computed: '_isValid(_body)'
          },
          _params: {
            type: Object,
            computed: '_computeParams(uid,project)'
          },
          _body: {
            type: Object,
            computed: '_computeBody(project,uid,save)'
          },
          save: Object,
          settings: {
            type: Array,
            computed: '_get(_results2.prj.settings)',
            notify: true
          },
          labels: {
            type: Array,
            computed: '_get(_results2.prj.labels)',
            notify: true
          }
        },

        _isValid: function(body) {
          return body && true;
        },

        _computeParams: function(uid, prj) {
          var ret = Object.create(null);
          ret.uid = uid;
          ret.prj = prj;
          return ret;
        },

        _computeBody: function(prj, uid, save) {
          if (!prj || !uid || !save)
            return;

          return {
            uid: uid,
            prj: prj,
            set: save.settings,
            labels: save.labels
          }
        },

        getSettings: function() {
          this.$.xhr2.generateRequest();
        },

      });
    })();
  </script>
</dom-module>
